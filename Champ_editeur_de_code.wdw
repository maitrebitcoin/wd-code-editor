#To edit and compare internal_properties, use WINDEV integrated tools.
#Internal properties refer to the properties of controls in windows, reports, etc.
info :
 name : Champ_editeur_de_code
 major_version : 28
 minor_version : 0
 type : 8
 description : ""
 subtype : 0
window :
 name : Champ_editeur_de_code
 identifier : 0x23ba8a0d04238390
 internal_properties : CAAAAAgAAAD5Qpey4DLRy/kzCyk2gY4echW2gHK9fzDgoIiAoZeH1lj/oMkAHMsrvgBLeBEQvtnpjPvsKMgK3r4dkac64zdS34GRhbOFhBy+yyWu1Sz0YRiA8YofwMKfR6Q8YYHLWcogsnhCdR/GwG4digwRFQMPV+fQXFvGU+/Ru7Zw3AyxVu1VkaVS2rilJ72s0miY9ppuLNw+R84pXMa2wOCkNcpkkN/cOHbrKEaRRXyylU4Z3rjt8sH8kvUTJHWBod1BFhcBmvwSRHisoprzfYpbHch4nt69qqvp1QPnqzzyCnZthwUUEHELaPOpjZ1FaRBjQz7tRWMNljglS2ZELlcPDBu/8vlgjB/jBc5alioXwU3DCgLmI8r4IzU0huQC1wacSMLLt6tsFxXr3DJFFCiY5SkzAmqN5yhTimjMRkNunI1aEvLFL4gFM9CXPw6F0cHGqiHS3qrIFoeNnYksmeEWHWMYMLvV991rw7kORQEVZzqgjew3DzWfOCnV9HgDi3/7+WDrlOX3WBIInOAesZ+cZMzzTMUQ2ZTNtm3Pnhp0WVn8Nt0KesJ32UALI2QmhqNVbZ0TpXguDDadEGhJaKKmPHBdIpvFQjxxbihgRyC5xa80Swih5BtLN1mkpOholNRHpfXlLqys9fQmHt5dBNkkkzUjWRbuwIE/hMjaxc/QxGPP7NazKyOoSJ+yPYMMeN6hkBxCNej2gtM6bnka8BbaicLl+/pihQad
 properties :
  width : 640
  height : 480
 controls :
  -
    name : Champ_editeur_de_code
    identifier : 0x23ba8a0d04248390
    internal_properties : CAAAAAgAAADKpPPh1RbJq7H8N2MsvsM+sMmlRc5da67B/V1zPzTk06dyOwKVvnBPPSlCyQ0X8N6AT6vfnNgUPGSngQAwNJsM7+pDcUD9ymLrqzTv9L3I3bJWpSDp6nJchxYrPNLk+FLA9KIEAfQeWc9BQnUl135v0xMdM+N+cc0VHPt/VXsJPF5fJ1+skAYOYhlO6nGZLQ9m5v3mb3FJHUjcoCsu6K/U9Zr13bYiRkyOrVFPfsl0WzTHCAcSkk7Po3ppAdQk7CLxnN0pj2Zhgfvl+5tfaAoEzIyukLq61JM+nsiqrg48xx1KtST3E5srvQTxFexzVZdWKxGd0/N3fSCbJGiFM4K6e/oXh8Owc3uc/HOlUNSn3qODXRoNO+Its2XDRdIphnc3ni9Nhaa1vPRQtdaWp0HWpmfKzI9LtWVP4QjhKLaMRFuD+d1FpWR6Yr8OhQ==
    properties :
     width : 640
     height : 480
    controls :
     -
       name : HTML_edit_code
       identifier : 0x23ba8a0d04258390
       internal_properties : CAAAAAgAAAA/eOjbKS1uyfyzB+aSEfdKGPFRQcJlQQOhJbBvL//r3hrOI+RJlzjIxTsfTfowBqfkWqpuRt7w1/hpIqRy+yepUnL9qQg+AHPwMSMmiXp86JI2PbY9I3YB2lgI4ulKS/Z81ekBnpxxBNNVsWwvDxKy684jQPW4Yn/qCnhywRxQiVlqKdh2slkxz+R3eB5wqUdlwEwiaw85MbiohCx4ApYjLTjklEnUzResBhajQQP6uosuxqjyfl31ddGsfTJcL4LengTdUPrpIOj1M6mAjNJFwRKW3FRQLikZS1uOwxHNJ3IaYLShvs2DahV96wLGYYYZgXlgKABJlYBBUkXhkBYh/iWmpRmnDKGL4pV9IQX6Wdp7Kh1K8cuQx75VTJFayfQErVo9a+G7GMXHAqA1LQSFLvXl/4LZCjw5hyt15yeZm6IJwIbmnW0Fj97C6VxSPAh8lLdP/bSDDMO+adkWO3MUUH0k4p8gfMIqtiNl5x5Sl7uIwzonRxXxAiId7ZaOqvv+7f0XNDqLHByxQZ9Eu2JB/tzvvvybmi/3aJbqlwEIpG+ViwCY3Idr27pwVVzJt3i3/JxuATJzxzsKCIvjhIR/mhiLcnAqe+0WZNZkLzESS/WCbuF5Dlq0kw4J7J4CmwdFvg+1t4Arm+DzP5lCbEGXC910Uo2sNo7rzxVrrAs=
       properties :
        width : 640
        height : 480
       type : 23
       code_elements :
        type_code : 36
        p_codes :
         -
           code : |1+
            global
            	chargement_termine est un booléen
           type : 14
         -
           code : |1+
            PROCÉDURE ClicLien(sUrl est chaine, bDansNouvelleFenetre est un booléen, sDestination est une chaine)
            
            RENVOYER Vrai
           type : 266
         -
           code : |1+
            PROCEDURE ChangePage( sUrl est chaine, sDestination est une chaine )
            
            RENVOYER Vrai
           type : 290
         -
           code : |1-
            
            chargement_termine = vrai
           type : 267
         -
           code : |1+
            PROCEDURE ChargementRessources( sUrl est chaine, nType est entier )
            // nType donne le type de ressource à télécharger
            // exemple : typehtmlResImage, typehtmlResScript, typehtmlResCss, typehtmlResXMLHttpRequest, typehtmlAutre
            // ATTENTION : ce traitement est appelé depuis un thread secondaire
            RENVOYER Vrai
            
           type : 289
         -
           code : |1+
            PROCEDURE ClicDroitLien( sUrl est chaine )
           type : 291
    type : 32
    code_elements :
     type_code : 70
     p_codes :
      -
        code : |1+
         PROCEDURE MaFenêtre()
         
         global
         	code_saisi est une chaîne UNICODE
         	
         	Traitement_Modification est une procédure
         	
         ParametreEditeur est une structure
         	avec_numéro_de_ligne est booléen // si vrai affiche les n° de ligne a gauche
         	avec_tab 			 est booléen // si vrai la touche TAB est utilisable dans le champ
         	nom_langage          est chaîne  // ex : "js" 
         	definition_token     est chaine  // expressions qui définissent le langage si on en veut un personnalisé
         	style_css_token      est chaine  // css pour les couleurs des token. mettre "" pour <par défaut>
         fin
      -
        code : |1+
         // récup de la valeur affectée
         code_saisi = MoiMême..Valeur
         // affecter dans le html
         _set_code()
        type : 43
      -
        code : |1+
         MoiMême..Valeur = code_saisi
         
        type : 42
 menu :
  name : _Menu
  identifier : 0x23b27b2e02e88cc1
  internal_properties : CAAAAAgAAAABuiDdDKH7981ND6pQYOtGLupg0XoQvXcJmw/tKdeIXjdaqbIdOt6u0YbpUtNJJuYOi6N6iz+igNY0mxbBusOWp0uVynfKDwECwE7Aq9YpjRCy18vIQfudU/wyNofqD9RQeKP0TUqu/I/ARXJDldW3aRQdmb2Z5B+RqTe1EkNAreBzqEk+ciFRXt8vYxRoUV9kuNJXcE/eeWLnX+I6I2hA/rYmgbhr4PRLRPjm8a9S3WPLcHscJyvxu6qyajLPombJ12UXDxGuNKliq8c/xa/8GxywA6otig==
  options : []
 languages :
  - fr-FR
 popup_menus : []
 message_bar : {}
 code_elements :
  type_code : 71
  p_codes : []
  procedures :
   -
     name : onModifCode
     procedure_id : 1421600420833690512
     type_code : 14
     code : |1+
      // appelé depuis le JS a chaque modification du code
      procédure onModifCode()
      
      code_saisi = HTMLValeurChamp(HTML_edit_code,"val")
      
      // appel de la callbakc utilisaeur si définie
      si Traitement_Modification<>null ALORS
      	Traitement_Modification( code_saisi )
      FIN
      
     type : 458752
   -
     name : init_editeur
     procedure_id : 1421600420833756048
     type_code : 14
     code : |1-
      procédure init_editeur( parametre_editeur est ParametreEditeur  )
      
      // Init du champ HTML avec un champ <P> géré par le JS de codeflask
      // voir https://github.com/kazzkiq/CodeFlask
      code_html est chaîne = [
      <html><§cs:4§>
      <head></head><§cs:4§>
      <style><§cs:4§>
      body {<§cs:4§>
          margin: 0;<§cs:4§>
          padding: 0;<§cs:4§>
      }<§cs:4§>
      STYLE_SI_CSS_PERSO<§cs:4§>
      </style><§cs:4§>
      <body><§cs:4§>
         <p id="editor" name="editor"/><§cs:4§>
         <form><§cs:4§>
            <textarea hidden id="val"></textarea><§cs:4§>
         </form><§cs:4§>
      </body><§cs:4§>
      <script language="Javascript" type="text/javascript"><§cs:4§>
      <§cs:4§>
      CODE_FLAKS_MIN_JS<§cs:4§>
      <§cs:4§>
      const editorElem = document.getElementById('editor');<§cs:4§>
      // creation editeur<§cs:4§>
      const flask = new CodeFlask(editorElem, { language: 'PARAM_LANGUAGE',<§cs:4§>
      										  defaultTheme: true,<§cs:4§>
      										  lineNumbers: false,<§cs:4§>
      										  handleTabs: false<§cs:4§>
      										});<§cs:4§>
      // CODE_SI_LANGUAGE_PERSO<§cs:4§>
      									<§cs:4§>
      // init a chaine vide										<§cs:4§>
      flask.updateCode('')<§cs:4§>
      // pour affecter le code depuis le WL<§cs:4§>
      const input_val = document.getElementById('val');<§cs:4§>
      function set_code() {<§cs:4§>
      	var new_code = input_val.value;<§cs:4§>
      	flask.updateCode(new_code)<§cs:4§>
      }<§cs:4§>
      // pour que la procédure onModifCode soit appelée a chaque modif du code<§cs:4§>
      flask.onUpdate( (code) => {<§cs:4§>
      	input_val.value= code;<§cs:4§>
      	WL.Execute("onModifCode")<§cs:4§>
      });<§cs:4§>
      <§cs:4§>
      // init termineé<§cs:4§>
      var init_terminee = 'ok';<§cs:4§>
      </script><§cs:4§>
      </html><§cs:4§>
      ]
      
      // code JS si on veut personnaliser le langage de l'éditeur de code
      // voir https://prismjs.com/tokens.html
      lang_perso est chaîne = parametre_editeur.nom_langage
      code_js_desc_language est chaine = [
      	Prism.languages['[%lang_perso%]'] = {
      		CODE_DEFINITION_TOKEN
      	};
       	flask.addLanguage('[%lang_perso%]', Prism.languages['[%lang_perso%]']);
      ]
      
      
      procédure interne _PatchHtml( a_rerchercher, valeur_finale )
      	code_html = Remplace( code_html,a_rerchercher,valeur_finale )
      FIN
      
      // inséreré le framework CodeFlask
      code_flash_code_sj est chaine = fChargeRessource("CodeFlask/codeflask.min.js")
      _PatchHtml( "CODE_FLAKS_MIN_JS", code_flash_code_sj )
      
      // init chaine
      _PatchHtml( "PARAM_LANGUAGE", parametre_editeur.nom_langage )
      
      si parametre_editeur.avec_numéro_de_ligne alors
      	_PatchHtml(  "lineNumbers: false", "lineNumbers: true" )
      fin
      SI parametre_editeur.avec_tab ALORS
      	_PatchHtml(  "handleTabs: false", "handleTabs: true" )
      FIN
      
      // si on veut un langage personnalisée
      si parametre_editeur.definition_token<>"" ALORS
      	s est chaine = Remplace( code_js_desc_language ,"CODE_DEFINITION_TOKEN", parametre_editeur.definition_token )
      	_PatchHtml("// CODE_SI_LANGUAGE_PERSO", s + rc)
      FIN
      // si on veut une coloration personnalisée
      SI parametre_editeur.style_css_token<>"" ALORS
      	_PatchHtml("STYLE_SI_CSS_PERSO", parametre_editeur.style_css_token)
      	_PatchHtml("defaultTheme: true", "defaultTheme: false")
      sinon
      	_PatchHtml("STYLE_SI_CSS_PERSO","")
      FIN
      
      
      // init champ HTML
      HTML_edit_code.chargement_termine = faux
      HTML_edit_code = code_html
      // attendre la fin de l'init
      tantque pas HTML_edit_code.chargement_termine
      	Multitache(1)
      FIN
        
     type : 458752
   -
     name : get_numero_de_ligne
     procedure_id : 1421934449037488553
     type_code : 14
     code : |1+
      // récupérer le n° de ligne ou se trouve le curseur
      procédure get_numero_de_ligne()
      
      code_js est chaine = [
         var input = flask.elTextarea
         var inputVal = input.value
         var selStartPos = input.selectionStart
         var beforeSelection = inputVal.substr(0, selStartPos)
         var lineNumber = beforeSelection.split('\n').length
         // renvoie la valeur
         lineNumber
      ]
      
      num_ligne est un entier
      terminé est un booléen
      si pas ExécuteJS(HTML_edit_code, code_js,(b,retval)=>{ num_ligne=retval;terminé=Vrai }  ) alors
      	renvoyer 0
      fin
       // "flask.lineNumber")
       tantque pas terminé
       	Multitâche(1)
       FIN
       
      
      renvoyer num_ligne
     type : 458752
   -
     name : cmd_aller_sur_une_ligne
     procedure_id : 1422666264221652743
     type_code : 14
     code : |1+
      // positionner le curseur sur une ligne donnée
      procédure cmd_aller_sur_une_ligne(local numero_ligne est entier)
      
      code_js est chaine = [
         	var code =  flask.elTextarea.value
         	var tab_ligne =  code.split('\n')
         	tab_ligne =	tab_ligne.slice(0, numero_ligne);
         	var pos = tab_ligne.join('\n').length
         	// positionner le curseur
      	flask.elTextarea.selectionStart = pos
      	flask.elTextarea.selectionEnd   = pos
      ]
      
      code_js= remplace(code_js,"numero_ligne", ""+numero_ligne)
      ExécuteJS(HTML_edit_code, code_js)
     type : 458752
   -
     name : _set_code
     procedure_id : 1427120733706407198
     type_code : 14
     code : |1+
      // affect le champ enJS a partir de <_set_code>
      procédure privée _set_code()
      
      // 0 binaires non autorisés
      SI Position(code_saisi,Caract(0)) ALORS
      	dbgAssertion(faux, "fichier invalide : avec 0 binaire")
      	code_saisi = ""
      FIN
      
      HTMLValeurChamp(HTML_edit_code,"val",code_saisi)
      ExécuteJS(HTML_edit_code,"set_code()")
      
     type : 458752
  procedure_templates : []
  property_templates : []
 code_parameters :
  internal_properties : CAAAAAgAAAA6ih3UbgNXHwTtiPSFUEj+2fi/m7v4QV2rqidAupM=
  original_name : FenêtreInterne1
resources :
 string_res :
  identifier : 0x13b27b2e001f8cc1
  internal_properties : CAAAAAgAAAAnMYFQ1bL/vz9ehh7L22SNNSlIzGTOI8h5F/WtgDNP
custom_note :
 internal_properties : CAAAAAgAAAC68/W0/adbG0nFCRhrE42B5HRnbDzVHaz86sSQyxlBk7I=
rad :
 internal_properties : CAAAAAgAAABoAN7PLpwJW3EiA7WVZdCA5EwrCA1rvutcDHooMWKe
