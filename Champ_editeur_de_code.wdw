#To edit and compare internal_properties, use WINDEV integrated tools.
#Internal properties refer to the properties of controls in windows, reports, etc.
info :
 name : Champ_editeur_de_code
 major_version : 28
 minor_version : 0
 type : 8
 description : ""
 subtype : 0
window :
 name : Champ_editeur_de_code
 identifier : 0x23ba8a0d04238390
 internal_properties : CAAAAAgAAAALSfjJgBziKOrr5XZhSloO1JEQz1qLsIwjvz5qxrtXZq7gKW4ESS3NANkSTWteOrkeWLmQCRKvFovL3cTJh+Qzd8rYDor1nR4O9hleeurcRByaJaH55iGer3bJyWqI39umqXJTCrYZ4OXVAv8nf11CY606NyrVKHWQvmbpPhqT6icwgvKtbel68oy58/QSTlBiRmqhgK3YNmG4zOKORF5Nwn5/7U1YfxNOfR+/2mIykYbeJf68z9Om4P2ud/+t7pp83uNGn/rxwyLVuz/JqChFowBcMS3U+oXHYczz8uFnSDQZBJib7B7fFfbErOzM1X1+Z4EInbqGI0GH8U6P40fnup4nQBfbP6fUYlQgaw9ETB+hihnxkV5oILd4UUTj42cUiQtXqC1nPJh0p/bqxat4+AcTBMb3rxKCwsbDmb6UC62yGyVeSQevRigo1QDC++EcFaybNM6BY9qsIQU2qpVMlO8d2xOxk6m0MXDl1rFcV+8oAvrRYem5gizUbQot5TDAHJi1TWQpz3kVnMQqQI6NHXu8qcH+tgTfMHRne0XDVgZE2TBA57j8A7RXspjwIRghxbEBkwroL57MsbU2CXIlFPP1RKQzGSYMdQVwTf6ffIXu/vAqFfuXr35BwhnNk/OiUGGMHWuQtfkb+3h0nYh3VmKu7QA6DuHKrjfMivP4unDtJUBg2uGJFNUSrr9RSi0rmRVH0yDnLfrLSxhLsLB+UrBW04OxBUN7Eq+OBYsWdh8k6A==
 properties :
  width : 640
  height : 480
 controls :
  -
    name : Champ_editeur_de_code
    identifier : 0x23ba8a0d04248390
    internal_properties : CAAAAAgAAABW5DLVl3R6OEnr/TF3rgbyJ2H6OQNd7WagdST7HE2N3CbEFLnxuwFaYgC4DZ0R8AFClTLu5hCRXNmh+cl8WnmrNyM+TthOp/d7PKjYuls0jKn+PVIPQ+n3NwIhX1pjUpt9HgozTyrF80XvC+QzkQUZsVqWsHXVdK4ip2cyeika+do84Qy93CcFjWqaD81b/IXuRCCSV87l/kJBNib+ef/KgX9Fim/HjHZow3pbMFVioB52IxX7nUwc04Ml+dVfr7MB0MyEL2YP/OUkR7J2afmwc5JFflR3tQ9JUgGpqjRorgi+PtcLnb3qzeeq8IUf/WrNZaaDzCLdAD8V1E30jwrweeMDtOk1OqkNQ1ckZpHpf1fZZA3z0rsjRHgD02PrvgbulXSqNq8d06qOcKO3hOEgQjg6VjCtWdFBJopSTyOS9wcs6CVghbKGt7WrL2R2/2udZtbJI8/bnuttZABUZbtzNFnV
    properties :
     width : 640
     height : 480
    controls :
     -
       name : HTML_edit_code
       identifier : 0x23ba8a0d04258390
       internal_properties : CAAAAAgAAAAeEFAmQZAlGA3SICRRBm5hr1z5QPr4UiUSBqXqUnDEgS4JqfI6NaM5KzQZCq8iCGfRCbaNftB10sfe947Ns1K0mNMRUx1Iuj5wvUyuFnomtqCfbcenWrx6tYCMUfeT1CTcTvE1pAoDbyqxrZcPGHtONwUaUXe5k99HPdOXUr2ZKxbPqOsBl+5HNNSdO0MVjLX75Wun5Nu9FUSK5S/1GxB3WqZ+RCbBBUbKv4atsc9H5NnNIM9ESc3eCff6WtLaritiWkxKIANNZDzxSyVdWm4WQLlYUGSWoTXdIIW8TeNQd8LRozcCd9LdmiVrJ4KHTBOnSWoaCAAd+pftfjCMTl+RbpbvjmemdvMfPLIXhRcaz0/YUg3iVCdqCnNUVw3UZ4ouPpcaqWF5eyyNfTpePg0TmjgBLb8MUKgVFnsESycU85hDMn22kTYH/UVUtzXZQCkn5LuGVXQk0MDqRm0uyHPlvls22TkrXZUHno8HfAwO9yRMkx+7g4KKpxvnUJ/0qSe0cJxQdo1XjIqvBKkaY/Abjtf+r8Knkefxv4p6q6pBtnL3l/4FZT0rzY/LoZuXKu+huiqj/eArApjJdAv6Wqh7kmpZ6CUK6nPCTpjtvOerrB09ef7HGo5d/PwPdCiGIVx1vVTW12MJw3EOEgOkEH2GP3KHOiDLbErNpohjTrSy/730fyFco834tFjJ0/zIayrZhYmuFVHSNC4=
       properties :
        width : 640
        height : 480
       type : 23
       code_elements :
        type_code : 36
        p_codes :
         -
           code : |1+
            global
            	chargement_termine est un booléen
           type : 14
         -
           code : |1+
            PROCEDURE ChangePage( sUrl est chaine, sDestination est une chaine )
            
            RENVOYER Vrai
           type : 290
         -
           code : |1-
            
            chargement_termine = vrai
           type : 267
         -
           code : |1+
            PROCEDURE ChargementRessources( sUrl est chaine, nType est entier )
            // nType donne le type de ressource à télécharger
            // exemple : typehtmlResImage, typehtmlResScript, typehtmlResCss, typehtmlResXMLHttpRequest, typehtmlAutre
            // ATTENTION : ce traitement est appelé depuis un thread secondaire
            RENVOYER Vrai
            
           type : 289
         -
           code : |1+
            PROCÉDURE ClicLien(sUrl est chaine, bDansNouvelleFenetre est un booléen, sDestination est une chaine)
            
            RENVOYER Vrai
           type : 266
         -
           code : |1+
            PROCEDURE ClicDroitLien( sUrl est chaine )
           type : 291
    type : 32
    code_elements :
     type_code : 70
     p_codes :
      -
        code : |1+
         PROCEDURE MaFenêtre()
         
         global
         	init_faite est un booléen 
         	code_saisi est une chaîne UNICODE
         	
         	Traitement_Modification est une procédure
         
         	
         ParametreEditeur est une structure
         	avec_numéro_de_ligne est booléen // si vrai affiche les n° de ligne a gauche
         	avec_tab 			 est booléen // si vrai la touche TAB est utilisable dans le champ
         	nom_langage          est chaîne  // ex : "js" 
         	definition_token     est chaine  // expressions qui définissent le langage si on en veut un personnalisé
         	style_css_token      est chaine  // css pour les couleurs des token. mettre "" pour <par défaut>
         fin
      -
        code : |1+
         // récup de la valeur affectée
         code_saisi = MoiMême..Valeur
         // affecter dans le html
         _set_code()
        type : 43
      -
        code : |1+
         MoiMême..Valeur = code_saisi
         
        type : 42
 menu :
  name : _Menu
  identifier : 0x23b27b2e02e88cc1
  internal_properties : CAAAAAgAAADr3pbrtpC4wpS8Uu9VfRbbRjL4kULgPf+Z41fVCbeIvreKecodkgZ+aWbp0lsxXm5Wg8saw++SqLa8o66xCtNWh/vFIlcyx4GKwL4gIy4hxcjqHyswwWulExSqHkcaz8QgSIOc7aLmrDcQRXZHOVEr5bi5ddmt4Lt99YvpVmecMbxX9PV6Nu2d6ltTN3iMvYNAHE7jzPN61Y7TcyYO1+T0CiryPVSPPBDX0My65dOeAd/v3IdIuwctl/YGfrbDnlrFy6FjC7Uqrqdiq/cHZ2seJcCMuwqH4A==
  options : []
 languages :
  - fr-FR
 popup_menus : []
 message_bar : {}
 actionbar : {}
 code_elements :
  type_code : 71
  p_codes : []
  procedures :
   -
     name : onModifCode
     procedure_id : 1421600420833690512
     type_code : 14
     code : |1+
      // appelé depuis le JS a chaque modification du code
      procédure onModifCode()
      
      code_saisi = HTMLValeurChamp(HTML_edit_code,"val")
      
      // appel de la callbakc utilisaeur si définie
      si Traitement_Modification<>null ALORS
      	Traitement_Modification( code_saisi )
      FIN
      
     type : 458752
   -
     name : init_editeur
     procedure_id : 1421600420833756048
     type_code : 14
     code : |1-
      procédure init_editeur( parametre_editeur est ParametreEditeur  )
      
      init_faite = Vrai
      
      // Init du champ HTML avec un champ <P> géré par le JS de codeflask
      // voir https://github.com/kazzkiq/CodeFlask
      code_html est chaîne = [
      <html>
      <head></head>
      <style>
      body {
          margin: 0;
          padding: 0;
      }
      STYLE_SI_CSS_PERSO
      </style>
      <body>
         <p id="editor" name="editor"/>
         <form>
            <textarea hidden id="val"></textarea>
         </form>
      </body>
      <script language="Javascript" type="text/javascript">
      
      CODE_FLAKS_MIN_JS
      
      const editorElem = document.getElementById('editor');
      // creation editeur
      const flask = new CodeFlask(editorElem, { language: 'PARAM_LANGUAGE',
      										  defaultTheme: true,
      										  lineNumbers: false,
      										  handleTabs: false
      										});
      // CODE_SI_LANGUAGE_PERSO
      									
      // init a chaine vide										
      flask.updateCode('')
      // pour affecter le code depuis le WL
      const input_val = document.getElementById('val');
      function set_code() {
      	var new_code = input_val.value;
      	flask.updateCode(new_code)
      }
      // pour que la procédure onModifCode soit appelée a chaque modif du code
      flask.onUpdate( (code) => {
      	input_val.value= code;
      	WL.Execute("onModifCode")
      });
      
      // init termineé
      var init_terminee = 'ok';
      </script>
      </html>
      ]
      
      // code JS si on veut personnaliser le langage de l'éditeur de code
      // voir https://prismjs.com/tokens.html
      lang_perso est chaîne = parametre_editeur.nom_langage
      code_js_desc_language est chaine = [
      	Prism.languages['[%lang_perso%]'] = {
      		CODE_DEFINITION_TOKEN
      	};
       	flask.addLanguage('[%lang_perso%]', Prism.languages['[%lang_perso%]']);
      ]
      
      
      procédure interne _PatchHtml( a_rerchercher, valeur_finale )
      	code_html = Remplace( code_html,a_rerchercher,valeur_finale )
      FIN
      
      // inséreré le framework CodeFlask
      code_flash_code_sj est chaine = fChargeRessource("CodeFlask/codeflask.min.js")
      _PatchHtml( "CODE_FLAKS_MIN_JS", code_flash_code_sj )
      
      // init chaine
      _PatchHtml( "PARAM_LANGUAGE", parametre_editeur.nom_langage )
      
      si parametre_editeur.avec_numéro_de_ligne alors
      	_PatchHtml(  "lineNumbers: false", "lineNumbers: true" )
      fin
      SI parametre_editeur.avec_tab ALORS
      	_PatchHtml(  "handleTabs: false", "handleTabs: true" )
      FIN
      
      // si on veut un langage personnalisée
      si parametre_editeur.definition_token<>"" ALORS
      	s est chaine = Remplace( code_js_desc_language ,"CODE_DEFINITION_TOKEN", parametre_editeur.definition_token )
      	_PatchHtml("// CODE_SI_LANGUAGE_PERSO", s + rc)
      FIN
      // si on veut une coloration personnalisée
      SI parametre_editeur.style_css_token<>"" ALORS
      	_PatchHtml("STYLE_SI_CSS_PERSO", parametre_editeur.style_css_token)
      	_PatchHtml("defaultTheme: true", "defaultTheme: false")
      sinon
      	_PatchHtml("STYLE_SI_CSS_PERSO","")
      FIN
      
      
      // init champ HTML
      HTML_edit_code.chargement_termine = faux
      HTML_edit_code = code_html
      // attendre la fin de l'init
      tantque pas HTML_edit_code.chargement_termine
      	Multitache(1)
      FIN
        
     type : 458752
   -
     name : get_numero_de_ligne
     procedure_id : 1421934449037488553
     type_code : 14
     code : |1+
      // récupérer le n° de ligne ou se trouve le curseur
      procédure get_numero_de_ligne()
      
      code_js est chaine = [
         var input = flask.elTextarea
         var inputVal = input.value
         var selStartPos = input.selectionStart
         var beforeSelection = inputVal.substr(0, selStartPos)
         var lineNumber = beforeSelection.split('\n').length
         // renvoie la valeur
         lineNumber
      ]
      
      num_ligne est un entier
      terminé est un booléen
      si pas ExécuteJS(HTML_edit_code, code_js,(b,retval)=>{ num_ligne=retval;terminé=Vrai }  ) alors
      	renvoyer 0
      fin
       // "flask.lineNumber")
       tantque pas terminé
       	Multitâche(1)
       FIN
       
      
      renvoyer num_ligne
     type : 458752
   -
     name : cmd_aller_sur_une_ligne
     procedure_id : 1422666264221652743
     type_code : 14
     code : |1-
      // positionner le curseur sur une ligne donnée
      procédure cmd_aller_sur_une_ligne(local numero_ligne est entier)
      
      _contourne_pb_focus()
      
      code_js est chaine = [
         	var code =  flask.elTextarea.value
         	var tab_ligne =  code.split('\n')
      	// récup code avant la ligne <numero_ligne>   	
          var	tab_ligne_avant =	tab_ligne.slice(0, numero_ligne-1);
         	var pos  = tab_ligne_avant.join('\n').length
         	// positionner le curseur	
      	flask.elTextarea.selectionStart = pos+1
      	flask.elTextarea.selectionEnd   = pos+1
      	// pour scroller sur le caret
      	flask.elTextarea.blur()
      	flask.elTextarea.focus()
      ]
      
      code_js= remplace(code_js,"numero_ligne", ""+numero_ligne)
      ExécuteJS(HTML_edit_code, code_js)
     type : 458752
   -
     name : cmd_selectionne_une_ligne
     procedure_id : 1430098829669191146
     type_code : 14
     code : |1+
      // sélectionner une ligne du code
      PROCÉDURE cmd_selectionne_une_ligne(LOCAL numero_ligne est entier)
      
      _contourne_pb_focus()
      
      code_js est chaîne = [
         	var code =  flask.elTextarea.value
         	var tab_ligne =  code.split('\n')
      	// récup code avant la ligne <numero_ligne>   	
          var	tab_ligne_avant =	tab_ligne.slice(0, numero_ligne-1);
          var	tab_ligne_apres =	tab_ligne.slice(0, numero_ligne);
         	var pos  = tab_ligne_avant.join('\n').length
         	var pos2 = tab_ligne_apres.join('\n').length
         	// positionner le curseur
      	flask.elTextarea.selectionStart = pos+1
      	flask.elTextarea.selectionEnd   = pos2+1
      	// pour scroller sur le caret
      	flask.elTextarea.blur()
      	flask.elTextarea.focus()	
      ]
      
      code_js= Remplace(code_js,"numero_ligne", ""+numero_ligne)
      ExécuteJS(HTML_edit_code, code_js)
     type : 458752
   -
     name : _set_code
     procedure_id : 1427120733706407198
     type_code : 14
     code : |1+
      // affect le champ enJS a partir de <_set_code>
      procédure privée _set_code()
      
      // init au 1er appel si non fait
      si pas init_faite ALORS
      	param_par_défaut est ParametreEditeur
      	init_editeur(param_par_défaut)
      FIN
      
      
      // 0 binaires non autorisés
      SI Position(code_saisi,Caract(0)) ALORS
      	dbgAssertion(faux, "fichier invalide : avec 0 binaire")
      	code_saisi = ""
      FIN
      
      HTMLValeurChamp(HTML_edit_code,"val",code_saisi)
      ExécuteJS(HTML_edit_code,"set_code()")
     type : 458752
   -
     name : _contourne_pb_focus
     procedure_id : 1430102987199484089
     type_code : 14
     code : |1+
      // contourne un pb de non prise de focus si on jamais cliqué sur le champ    
      procédure privée _contourne_pb_focus()
             
      // sauver la position du curseur
      ResXY est un entier = CurseurPos(cpEcran)
      soit x_sauve = PoidsFaible(ResXY)
      soit y_sauve = PoidsFort(ResXY)
      // clique dans le champ
      x est un entier = HTML_edit_code..Largeur/2
      y est entier = 20 // 1er ligne  
      PiloteSouris(HTML_edit_code,psEnfonceBoutonGauche,x,y)
      PiloteSouris(HTML_edit_code,psRelacheBoutonGauche,x,y)
      // restaure la position du curseur
      CurseurPos(cpEcran,x_sauve,y_sauve)
      
     type : 458752
  procedure_templates : []
  property_templates : []
 code_parameters :
  internal_properties : CAAAAAgAAACVGQgYbalU7DKC3oH4ItDrjtcTHXXV/EuH8q0IbhyQlw==
  original_name : FenêtreInterne1
resources :
 string_res :
  identifier : 0x13b27b2e001f8cc1
  internal_properties : CAAAAAgAAACm76HWfKGWp33VjXInA4cRlqArlgTTA862QGt72W2ld5Y=
custom_note :
 internal_properties : CAAAAAgAAAC68/W0/adbG0nFCRhrE42B5HRnbDzVHaz86sSQyxlBk7I=
rad :
 internal_properties : CAAAAAgAAABoAN7PLpwJW3EiA7WVZdCA5EwrCA1rvutcDHooMWKe
